<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>StampaText - Stamp Your Text on Beautiful Templates</title>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>

  <!-- Header -->
  <header class="header">
    <a href="/" class="header-logo"><img src="/logo.png" alt="stampatext" class="header-logo-img"></a>
    <div class="header-actions" id="header-actions">
      <span class="header-credits" id="user-credits" style="display:none;">0 credits</span>
      <button class="btn btn-secondary btn-small" id="btn-login" onclick="openModal('login')">Login</button>
      <button class="btn btn-primary btn-small" id="btn-signup" onclick="openModal('signup')">Sign Up</button>
      <a href="/app" class="btn btn-primary btn-small" id="btn-go-app" style="display:none;">Go to App</a>
    </div>
  </header>

  <!-- Hero Section -->
  <section class="stamp-hero">
    <h1 class="stamp-hero-title">Welcome, have your text stamped on hundreds of gorgeous models of stamps, stickers, blackboards, speech bubbles, banners, buttons and more</h1>
    <div class="stamp-hero-input-wrapper">
      <input type="text" class="stamp-hero-input" id="stamp-input"
             placeholder="write the text you want to stamp and I'll be on it in seconds"
             maxlength="300">
      <button class="btn btn-primary stamp-hero-btn" id="stamp-btn">Stamp</button>
    </div>
  </section>

  <!-- Results Section -->
  <section class="stamp-results" id="stamp-results" style="display:none;">
    <!-- Filter Bar (inside results, right above the batches) -->
    <div class="stamp-filter-bar" id="stamp-filter-bar" style="display:none;">
      <span class="filter-bar-label">Filter:</span>
      <select id="filter-border-style" class="filter-bar-select">
        <option value="">All border styles</option>
        <option value="1">Plain</option>
        <option value="2">Stitch</option>
        <option value="3">Zigzag / Perforated</option>
        <option value="4">Irregular</option>
      </select>
      <select id="filter-border-count" class="filter-bar-select">
        <option value="">All border counts</option>
        <option value="single">Single</option>
        <option value="double">Double</option>
        <option value="split">Split</option>
      </select>
      <select id="filter-corners" class="filter-bar-select">
        <option value="">All corners</option>
        <option value="straight">Straight</option>
        <option value="soft_round">Soft Round</option>
        <option value="medium_round">Medium Round</option>
        <option value="strong_round">Strong Round</option>
      </select>
      <select id="filter-fill" class="filter-bar-select">
        <option value="">All fills</option>
        <option value="full">Filled</option>
        <option value="empty">Outlined</option>
      </select>
      <button class="btn btn-small filter-bar-reset" id="filter-reset">Reset</button>
    </div>
    <div id="results-batches"></div>
  </section>

  <!-- Filters Modal -->
  <div class="modal-overlay" id="filters-modal">
    <div class="modal" style="max-width:680px;">
      <button class="modal-close" id="filters-modal-close">&times;</button>
      <h3 class="modal-title">Preferences</h3>

      <!-- COLORS -->
      <div class="filter-section">
        <div class="filter-section-header">
          <span class="filter-section-title">COLORS</span>
          <a href="#" class="filter-select-all" data-target="color-palette">Select all</a>
        </div>
        <div class="color-palette" id="color-palette"></div>
      </div>

      <!-- OBJECT -->
      <div class="filter-section">
        <div class="filter-section-header">
          <span class="filter-section-title">OBJECT</span>
          <a href="#" class="filter-select-all" data-target="object-filters">Select all</a>
        </div>
        <div class="filter-checkboxes" id="object-filters">
          <label class="filter-checkbox-label"><input type="checkbox" value="stamp"> Stamp</label>
          <label class="filter-checkbox-label filter-coming-soon"><input type="checkbox" value="sticker" disabled> Sticker</label>
          <label class="filter-checkbox-label filter-coming-soon"><input type="checkbox" value="button" disabled> Button</label>
          <label class="filter-checkbox-label filter-coming-soon"><input type="checkbox" value="banner" disabled> Banner</label>
          <label class="filter-checkbox-label filter-coming-soon"><input type="checkbox" value="bubble_cloud" disabled> Bubble / Cloud</label>
          <label class="filter-checkbox-label filter-coming-soon"><input type="checkbox" value="blackboard" disabled> Blackboard</label>
        </div>
      </div>

      <!-- SHAPE -->
      <div class="filter-section">
        <div class="filter-section-header">
          <span class="filter-section-title">SHAPE</span>
          <a href="#" class="filter-select-all" data-target="shape-filters">Select all</a>
        </div>
        <div class="filter-checkboxes" id="shape-filters">
          <label class="filter-checkbox-label"><input type="checkbox" value="rectangle"> Rect / Square</label>
          <label class="filter-checkbox-label filter-coming-soon"><input type="checkbox" value="lined" disabled> Lined</label>
          <label class="filter-checkbox-label filter-coming-soon"><input type="checkbox" value="circle_ellipse" disabled> Circle / Ellipse</label>
          <label class="filter-checkbox-label filter-coming-soon"><input type="checkbox" value="irregular" disabled> Irregular</label>
        </div>
      </div>

      <!-- BORDER COUNT -->
      <div class="filter-section">
        <div class="filter-section-header">
          <span class="filter-section-title">BORDER COUNT</span>
          <a href="#" class="filter-select-all" data-target="frame-filters">Select all</a>
        </div>
        <div class="filter-checkboxes" id="frame-filters">
          <label class="filter-checkbox-label"><input type="checkbox" value="single"> Single</label>
          <label class="filter-checkbox-label"><input type="checkbox" value="double"> Double</label>
          <label class="filter-checkbox-label"><input type="checkbox" value="split"> Split</label>
        </div>
      </div>

      <!-- BORDER STYLE -->
      <div class="filter-section">
        <div class="filter-section-header">
          <span class="filter-section-title">BORDER STYLE</span>
          <a href="#" class="filter-select-all" data-target="border-filters">Select all</a>
        </div>
        <div class="filter-checkboxes" id="border-filters">
          <span class="filter-group-label">Plain</span>
          <label class="filter-checkbox-label"><input type="checkbox" value="simple"> Plain</label>
          <span class="filter-group-label">Stitch</span>
          <label class="filter-checkbox-label"><input type="checkbox" value="stitch_line"> Stitch line</label>
          <label class="filter-checkbox-label"><input type="checkbox" value="stitch_square"> Stitch square</label>
          <label class="filter-checkbox-label"><input type="checkbox" value="stitch_circle"> Stitch dot</label>
          <span class="filter-group-label">Zigzag / Perforated</span>
          <label class="filter-checkbox-label"><input type="checkbox" value="zigzag"> Zigzag</label>
          <label class="filter-checkbox-label"><input type="checkbox" value="perforated"> Perforated</label>
          <label class="filter-checkbox-label"><input type="checkbox" value="perforated_spaced"> Spaced perforated</label>
          <label class="filter-checkbox-label"><input type="checkbox" value="wavy"> Wavy</label>
          <span class="filter-group-label">Irregular</span>
          <label class="filter-checkbox-label"><input type="checkbox" value="brushstroke"> Brushstroke</label>
          <label class="filter-checkbox-label"><input type="checkbox" value="torn_edge"> Torn edge</label>
        </div>
      </div>

      <!-- CORNERS -->
      <div class="filter-section">
        <div class="filter-section-header">
          <span class="filter-section-title">CORNERS</span>
          <a href="#" class="filter-select-all" data-target="corner-filters">Select all</a>
        </div>
        <div class="filter-checkboxes" id="corner-filters">
          <label class="filter-checkbox-label"><input type="checkbox" value="straight"> Straight</label>
          <label class="filter-checkbox-label"><input type="checkbox" value="soft_round"> Soft round</label>
          <label class="filter-checkbox-label"><input type="checkbox" value="medium_round"> Medium round</label>
          <label class="filter-checkbox-label"><input type="checkbox" value="strong_round"> Rounded</label>
        </div>
      </div>

      <!-- FILL -->
      <div class="filter-section">
        <div class="filter-section-header">
          <span class="filter-section-title">FILL</span>
          <a href="#" class="filter-select-all" data-target="fill-filters">Select all</a>
        </div>
        <div class="filter-checkboxes" id="fill-filters">
          <label class="filter-checkbox-label"><input type="checkbox" value="full"> Filled</label>
          <label class="filter-checkbox-label"><input type="checkbox" value="empty"> Outlined</label>
        </div>
      </div>

      <!-- TEXTURE -->
      <div class="filter-section">
        <div class="filter-section-header">
          <span class="filter-section-title">TEXTURE</span>
          <a href="#" class="filter-select-all" data-target="texture-filters">Select all</a>
        </div>
        <div class="filter-checkboxes" id="texture-filters">
          <label class="filter-checkbox-label"><input type="checkbox" value="none"> No texture</label>
          <label class="filter-checkbox-label"><input type="checkbox" value="grungy"> Grungy</label>
          <label class="filter-checkbox-label"><input type="checkbox" value="worn"> Worn</label>
          <label class="filter-checkbox-label"><input type="checkbox" value="scratched"> Scratched</label>
          <label class="filter-checkbox-label"><input type="checkbox" value="speckled"> Speckled</label>
          <label class="filter-checkbox-label"><input type="checkbox" value="noise"> Noise</label>
        </div>
      </div>

      <!-- TILT -->
      <div class="filter-section">
        <div class="filter-section-header">
          <span class="filter-section-title">TILT</span>
          <a href="#" class="filter-select-all" data-target="tilt-filters">Select all</a>
        </div>
        <div class="filter-checkboxes" id="tilt-filters">
          <label class="filter-checkbox-label"><input type="checkbox" value="0"> Straight</label>
          <label class="filter-checkbox-label"><input type="checkbox" value="-20"> 20 degrees</label>
        </div>
      </div>

      <!-- QUANTITY -->
      <div class="filter-section">
        <div class="filter-section-header">
          <span class="filter-section-title">RESULTS PER BATCH</span>
        </div>
        <div class="filter-checkboxes" id="quantity-filters">
          <label class="filter-checkbox-label"><input type="radio" name="quantity" value="9" checked> 9</label>
          <label class="filter-checkbox-label"><input type="radio" name="quantity" value="18"> 18</label>
          <label class="filter-checkbox-label"><input type="radio" name="quantity" value="24"> 24</label>
        </div>
      </div>

      <button class="btn btn-primary" id="btn-apply-filters" style="width:100%;">Show stamps</button>
    </div>
  </div>

  <!-- Auth Modal -->
  <div class="modal-overlay" id="auth-modal">
    <div class="modal">
      <button class="modal-close" onclick="closeModal()">&times;</button>

      <div class="modal-tabs">
        <button class="modal-tab active" id="tab-login" onclick="switchTab('login')">Login</button>
        <button class="modal-tab" id="tab-signup" onclick="switchTab('signup')">Sign Up</button>
      </div>

      <!-- Login Form -->
      <form id="form-login" onsubmit="handleLogin(event)">
        <div class="form-group">
          <label class="form-label" for="login-email">Email</label>
          <input class="form-input" type="email" id="login-email" required>
        </div>
        <div class="form-group">
          <label class="form-label" for="login-password">Password</label>
          <input class="form-input" type="password" id="login-password" required>
        </div>
        <div class="form-error" id="login-error"></div>
        <button class="btn btn-primary form-submit" type="submit" id="login-submit">Login</button>
      </form>

      <!-- Sign Up Form -->
      <form id="form-signup" style="display:none;" onsubmit="handleSignup(event)">
        <div class="form-group">
          <label class="form-label" for="signup-email">Email</label>
          <input class="form-input" type="email" id="signup-email" required>
        </div>
        <div class="form-group">
          <label class="form-label" for="signup-password">Password</label>
          <input class="form-input" type="password" id="signup-password" required minlength="6">
        </div>
        <div class="form-group">
          <label class="form-label" for="signup-confirm">Confirm Password</label>
          <input class="form-input" type="password" id="signup-confirm" required minlength="6">
        </div>
        <div class="form-error" id="signup-error"></div>
        <button class="btn btn-primary form-submit" type="submit" id="signup-submit">Create Account</button>
      </form>
    </div>
  </div>

  <!-- Scripts -->
  <script src="/js/supabase.umd.js"></script>
  <script src="/js/config.js"></script>
  <script src="/js/supabase-client.js"></script>
  <script src="/js/auth.js"></script>
  <script src="/js/router.js"></script>
  <script src="/js/svg-renderer.js?v=41"></script>
  <script src="/js/gallery.js?v=35"></script>
  <script>
    // Inline restore check — runs BEFORE stamp-app.js, cannot be cached separately
    (function() {
      var p = new URLSearchParams(window.location.search);
      var textParam = p.get('text');
      if (!textParam) return;

      document.getElementById('stamp-input').value = textParam;
      var savedText = localStorage.getItem('stx-gallery-text');
      var savedParams = localStorage.getItem('stx-gallery-params');

      if (savedParams && savedText === textParam) {
        // We have variant params — stamp-app.js will use Gallery.restoreVariants()
        try {
          window.__galleryVariantParams = JSON.parse(savedParams);
        } catch (e) { /* corrupt data, ignore */ }
      }
    })();
  </script>
  <script>document.write('<scr'+'ipt src="/js/stamp-app.js?t='+Date.now()+'"></scr'+'ipt>')</script>
  <script>
    function openModal(tab) {
      document.getElementById('auth-modal').classList.add('active');
      switchTab(tab || 'login');
    }

    function closeModal() {
      document.getElementById('auth-modal').classList.remove('active');
      document.getElementById('login-error').classList.remove('visible');
      document.getElementById('signup-error').classList.remove('visible');
    }

    function switchTab(tab) {
      var tabLogin = document.getElementById('tab-login');
      var tabSignup = document.getElementById('tab-signup');
      var formLogin = document.getElementById('form-login');
      var formSignup = document.getElementById('form-signup');

      if (tab === 'login') {
        tabLogin.classList.add('active');
        tabSignup.classList.remove('active');
        formLogin.style.display = 'block';
        formSignup.style.display = 'none';
      } else {
        tabSignup.classList.add('active');
        tabLogin.classList.remove('active');
        formSignup.style.display = 'block';
        formLogin.style.display = 'none';
      }
    }

    function getRedirectUrl() {
      return window.location.pathname + window.location.search;
    }

    async function handleLogin(e) {
      e.preventDefault();
      var email = document.getElementById('login-email').value;
      var password = document.getElementById('login-password').value;
      var errorEl = document.getElementById('login-error');
      var submitBtn = document.getElementById('login-submit');

      errorEl.classList.remove('visible');
      submitBtn.disabled = true;
      submitBtn.textContent = 'Logging in...';

      try {
        await signIn(email, password);
        closeModal();
        window.location.reload();
      } catch (err) {
        errorEl.textContent = err.message;
        errorEl.classList.add('visible');
        submitBtn.disabled = false;
        submitBtn.textContent = 'Login';
      }
    }

    async function handleSignup(e) {
      e.preventDefault();
      var email = document.getElementById('signup-email').value;
      var password = document.getElementById('signup-password').value;
      var confirm = document.getElementById('signup-confirm').value;
      var errorEl = document.getElementById('signup-error');
      var submitBtn = document.getElementById('signup-submit');

      errorEl.classList.remove('visible');

      if (password !== confirm) {
        errorEl.textContent = 'Passwords do not match';
        errorEl.classList.add('visible');
        return;
      }

      submitBtn.disabled = true;
      submitBtn.textContent = 'Creating account...';

      try {
        await signUp(email, password);
        closeModal();
        window.location.reload();
      } catch (err) {
        errorEl.textContent = err.message;
        errorEl.classList.add('visible');
        submitBtn.disabled = false;
        submitBtn.textContent = 'Create Account';
      }
    }
  </script>

</body>
</html>
